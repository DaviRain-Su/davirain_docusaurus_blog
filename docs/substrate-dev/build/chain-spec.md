# 链条规格

在 Substrate 中，链规范是描述基于 Substrate 的区块链网络的信息集合。例如，链规范标识了区块链节点连接到的网络、它最初与之通信的其他节点，以及节点必须就生成块达成一致的初始状态。

链规范是使用ChainSpecstruct定义的。该ChainSpec结构将链所需的信息分为两部分：

包含 Substrate外部节点用于与网络参与者通信并将数据发送到遥测端点的信息的客户端规范。许多这些链规范设置可以在启动节点时被命令行选项覆盖，或者可以在区块链启动后更改。
网络中所有节点都同意的初始创世状态。创世状态必须在首次启动区块链时建立，并且在没有启动全新区块链的情况下无法更改。
自定义外部节点设置
对于外部节点，链规范控制信息，例如：

节点与之通信的引导节点。
节点要向其发送遥测数据的服务器端点。
节点连接到的网络的人类和机器可读名称。
由于 Substrate 框架是可扩展的，您还可以自定义链规范以包含附加信息。例如，您可以将外部节点配置为连接到特定高度的特定块，以防止在从创世同步新节点时进行远程攻击。

请注意，您可以在创世后自定义外部节点设置。但是，节点只添加使用相同protocolId.

自定义创世配置
网络中的所有节点必须就创世状态达成一致，然后才能就任何后续区块达成一致。在链规范的创世部分中配置的信息用于创建创世块。它在您启动第一个节点时生效，并且不能被命令行选项覆盖。但是，您可以在链规范的创世部分配置一些信息。例如，您可以自定义链规范的创世部分以包含以下信息：

初始代币持有者余额。
最初属于治理委员会的帐户。
sudo控制密钥的管理帐户。
Substrate 节点还包括为链上的运行时逻辑编译的 WebAssembly，因此初始运行时也必须在链规范中提供。

存储链规格信息
链规范中的信息可以存储为 Rust 代码或 JSON 文件。Substrate 节点通常包括至少一个，通常是许多硬编码的链规范。将此信息作为 Rust 代码直接包含在节点中可确保节点可以连接到至少一个链，而无需节点操作员提供任何其他信息。如果您正在构建一个旨在定义主网络的区块链，则此主网络规范通常在外部节点中硬编码。

或者，您可以使用build-spec子命令将链规范序列化为 JSON 文件。在启动测试网络或私有链时，通常会使用节点二进制文件分发 JSON 编码的链规范。

提供链规范以启动节点
每次启动节点时，您都​​提供该节点应使用的链规范。在最简单的情况下，节点使用硬编码到节点二进制文件中的默认链规范。--chain您可以在启动节点时使用命令行选项来选择替代的硬编码链规范。例如，您可以通过指定--chain local为命令行选项来指示节点使用与字符串“local”关联的链规范。

如果您不想使用硬编码的链规范启动节点，可以将其作为 JSON 文件提供。例如，您可以someCustomSpec.json通过指定--chain=someCustomSpec.json为命令行选项来指示节点使用文件中的链规范。如果您指定 JSON 文件，节点会尝试反序列化提供的 JSON 链规范，然后使用它。

为运行时声明存储项
在大多数情况下，Substrate 运行时需要在创世时配置存储项。例如，如果您正在使用 FRAME 开发运行时，则使用Configtrait 声明的任何存储项都需要在创世时进行配置。这些存储值在链规范的创世部分中配置。

创建自定义链规范
如果您正在为开发、测试或演示目的创建一次性网络，您可能需要完全定制的链规范。要创建完全自定义的链规范，您可以将默认链规范导出为 JSON 格式，然后编辑 JSON 文件中的字段。例如，您可以使用build-spec子命令将链规范导出到 JSON 文件：

substrate build-spec > myCustomSpec.json

导出链规范后，您可以在文本编辑器中修改其任何字段。例如，您可能想要更改网络名称、引导节点和任何创世存储项目，例如代币余额。编辑 JSON 文件后，您可以使用自定义的 JSON 启动节点。例如：

substrate --chain=myCustomSpec.json

原链规格
Substrate 节点支持运行时升级。通过运行时升级，区块链的运行时可能与链开始时不同。链规范包含以节点运行时可以理解的方式构造的信息。例如，考虑以下来自默认 Substrate 节点的链规范.json文件的摘录：

"sudo": {
  "key": "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY"
}

在此链规范可用于初始化节点的创世存储之前，必须将人类可读的密钥转换为storage trie的实际存储密钥。这种转换是直截了当的，但它要求节点的运行时能够理解链规范。

如果具有升级运行时的节点尝试从创世同步链，它将无法理解此人类可读链规范中的信息。出于这个原因，链规范有第二种编码。第二个编码创建了链规范的原始版本。

当以 JSON 格式分发链规范时，您应该以原始格式分发它们，以确保即使在运行时升级后所有节点也可以同步链。基于 Substrate 的节点支持--raw生成原始链规范的标志。

substrate build-spec --chain=myCustomSpec.json --raw > customSpecRaw.json

转换为原始格式后，sudo key代码段如下所示：

"0x50a63a871aced22e88ee6466fe5aa5d9": "0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d",

下一步去哪里
添加可信节点
操作方法：配置创世状态
操作方法：自定义链规范
节点模板链规范
ChainSpec 结构
ProtocolId 结构