# 平行链的运行时升级
本指南的目标是帮助平行链开发人员确保运行时升级成功。

本指南说明：

如何修改平行链运行时（添加/删除托盘）
如何进行平行链存储迁移
平行链上的运行时升级有更严格的要求和稍微不同的流程，因为您必须与中继链协调以促进这一点。因此，状态转换协调的非常有限的性质既快速又简洁，足以将块包含在中继链中。

在您继续之前
请执行以下操作：

阅读通用运行时升级文档。
完成准备本地平行链测试网教程，并学习polkadot-launch测试工具。
选择您的升级方法
如果您现有的 Substrate 链有一个非常大的状态，您正在不同的存储格式之间迁移，则可能无法在一个块中运行所有运行时迁移。您可以使用一些策略来解决此问题：

如果要迁移的存储项目的数量可以在两个或三个区块内处理，您可以使用调度程序托盘运行迁移，以确保无论区块生产者如何都能执行迁移。
使用版本化存储并仅在访问尚未升级的存储值时执行迁移。这可能会导致用户之间交易费用的差异，并可能导致更复杂的运行时代码。但是，如果正确计量（权重进行了适当的基准测试），这种方法将确保迁移的停机时间最短。
如果您必须在多个块之间拆分迁移，您可以在链上或链下进行：

链上多块迁移将需要编写自定义托盘逻辑，该逻辑可以随时间排队更改或使用调度程序托盘一次迁移存储块。
除了将迁移代码添加到您的运行时，您还可以在链下手动生成迁移，system.setStorage并根据需要通过具有 root 权限的源（例如民主）使用多个调用来添加和删除存储项目。如果您可以进行的交易数量有限，您可以通过调度程序批量处理多个交易以随时间发生。
建立迁移策略后，您应该在非生产测试网上测试迁移，以确保在继续之前它可以正常工作。

在受限网络中进行测试将帮助您为真实网络中的潜在故障做好准备，该网络具有许多收集器和验证器以及带宽和延迟等限制条件。您越能模拟真实网络进行测试，就越能确定您的运行时升级会成功。

授权 -> 制定升级流程
当最终准备好升级平行链时，中继链需要在升级之前被告知你的链的运行时升级。Cumulus库提供的功能可帮助您通过以下方式通知中继链即将进行的升级：

用于authorize_upgrade提供升级的哈希值并对其进行授权。
用于enact_authorized_upgrade提供升级的实际代码。
调用这两个函数后，将通知中继链已安排新的升级。

例子
基板迁移示例 repo
放样托盘迁移逻辑
资源
运行时升级
分叉基板
try-runtime
try-runtime视频研讨会