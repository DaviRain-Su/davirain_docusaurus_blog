# 准备发射
本指南的目的是引导您了解如何在本地测试环境之外启动平行链。您将学习如何确保protocolId设置唯一并且运行时权重是正确的。

平行链的运行时约束比单链严格得多，因为您必须与中继链协调才能完成状态转换。在将平行链投入生产时，确保正确配置和测试链的运行时至关重要。

设置一个独特的protocolId
网络冲突可能会导致严重的头痛。 所有链都应该使用任何其他任何类型的网络（无论是测试网络、中继链还是平行链）都不使用的唯一性。 protocolId拥有唯一的协议标识符可确保您的节点与正确的对等节点连接，而不是与来自其他 libp2p 网络的节点连接。您希望将它们隔离到具有此 ID 的不同对等组。协议 ID 冲突会给您的节点带来许多问题。

为了设置唯一的协议 ID，请确保使用一些 nonce 或 salt 值进行更改。这被设置为（对于平行链节点模板）作为 CLI 项/client/network/src/command.rs，并传递给扩展/client/network/src/chain_spec.rs

所有链规范文件都包含此项作为字段。例如，主中继链运行时链规范具有唯一的协议 ID。对于波卡：

// raw chain spec file in polkadot repo `/node/service/chain-specs/polkadot.json`
{
  //--snip--
  "protocolId": "dot"
  //--snip--
}

密切关注（订阅）此问题 ，它将解决将来安全配置此常量的更好方法。

内存分析
应该进行整理器内存分析以分析内存泄漏、识别内存消耗发生的位置、定义临时分配以及调查应用程序中的过多内存碎片。

最小化运行时大小
在启动平行链时，使用运行时的压缩版本以尽可能降低中继链的资源消耗量至关重要。

建议推出功能有限的平行链，并随着运行时升级逐渐增加。其背后的原因是，在运行时升级期间，先前的运行时和新的运行时都包含在 PoVBlock 中，因此如果更改足够大，则由于 PoVBlock 大小限制，中继链可能会拒绝该块。
如果运行时包含在状态证明中，请确保 PoV 块（即外在集合，包括新运行时、PoV 状态证明，可能是旧运行时）符合 PoVBlock 大小限制。如果运行时不包含在状态证明中，那么新运行时的大小限制会高得多。
关键的平行链约束
您可以在 Polkadot 存储库中检查所有中继链的最大大小（这些是常用常量）。记下：

您所针对的中继链的运行时版本（这些可能会更改）
MAX_CODE_SIZE
MAX_HEAD_DATA_SIZE
MAX_POV_SIZE
你必须让你的平行链舒适地适应这些最大值。您还可以使用连接到中继节点的 Polkadot-JS 应用程序 UI 来查看这些常量：Developers -> ParachainsConfiguration -> ActiveConfiguration

使用适当的重量
使用运行时基准测试来确保您的运行时权重实际上是运行时使用的资源的指示。

自定义权重
如果您需要偏离基准，请确保运行时中的每个托盘都使用正确的加权系统。作为一般规则，默认和“猜测”权重不会在生产中使用。

设置块重量限制
由于块执行时间的不确定性，建议在开始时将块权重限制（块生产时间）设置为 0.5 秒。随着网络执行时间的稳定，权重限制可以增加到 2 秒。

设置呼叫过滤器
尤其是在启动平行链时，您可能需要高度限制为 特定类别的用户启用的内容。这可以通过呼叫过滤器来完成。

在这里，您可以看到一个示例，说明如何使用在Statemine 运行时部署中实现的过滤器来限制和启用功能。

增量运行时部署
如果您在启动前接近上述限制（例如过大的运行时），强烈建议尽可能减少功能并逐步升级。在这些情况下，您可以：

使用完整的运行时功能（包括所有托盘）生成链的创世状态
从运行时中删除所有在平行链启动时不需要的托盘
重新构建 WASM blob（验证逻辑）和链的运行时
使用更新的 Genesis 和 (3) 中生成的 WASM blob 注册您的平行链
平行链上线后，您可以升级链上运行时以包含丢失的托盘（确保托盘索引和名称与步骤（1）中用于生成创世状态的索引和名称匹配，而无需进行存储迁移。有关有关-chain 运行时升级参考下一节。
请参阅平行链运行时升级指南，了解如何实际执行这些增量运行时升级。

启动模拟
在您在生产测试网或主网上进行任何尝试之前，您应该在尽可能模拟真实网络行为的网络上启动您的链。在受限网络中进行测试将帮助您为真实网络中的潜在故障做好准备，该网络具有许多收集器和验证器以及带宽和延迟等限制条件。您越能模拟真实网络进行测试，就越能确定您的运行时升级会成功。

请参阅准备本地平行链测试网以了解用于此类测试自动化的工具选择。

例子
Statemine 运行时部署
资源
运行时升级的参考文档
使用基准权重的操作指南
try-runtime文档参考

try-runtime视频研讨会
Fork Off Substrate 工具
